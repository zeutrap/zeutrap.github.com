---
layout: post
title: "Amazon架构"
description: ""
category: "architecture"
tags: ["all-time-favorites系列", "一日一架构", "架构", "译文"]
---
{% include JB/setup %}

本文翻译自 HighScalability.com的[Amazon Architecture](http://highscalability.com/amazon-architecture)一文。

##信息源  
* Greg Linden的[Early Amazon](http://glinden.blogspot.com/2006/05/early-amazon-end.html)  
* [How Linux saved Amazon millions](http://news.com.com/2100-1001-275155.html)  
* [Interview Werner Vogels](http://www.se-radio.net/index.php?post_id=157593)  
* Chiris Loosley的[异步架构-Werner Vogels演讲摘要](http://www.webperformancematters.com/journal/2007/8/21/asynchronous-architectures-4.html)  
* [Learning from the Amazon technology platform](http://www.acmqueue.com/modules.php?name=Content&pa=showpage&pid=388) 
* [Werner Vogels的博客](http://www.allthingsdistributed.com/)  

##平台
* Linux
* Oracle
* C++
* Perl
* Mason
* Java
* Jboss
* Servlets

##数字  
* 超过5千5百万活跃买家。
* 世界范围内超过了1百万活跃零售合作伙伴。  
* 每个页面的组成都访问了100-150个服务。  

##架构
* 扩展性真正意味着什么？一个服务能够通过增加系统的资源从而成比例地提高系统性能，那么它就可以被成为可扩展的。提高性能通常意味着能够为更多单元提供服务，但也能够处理更大单元，比如处理数据库的增长。  
* Amazon所做的一个大的架构调整是从一个两层的庞然大物转变成一个完全分布式、去中心化、为大量不同应用提供服务的平台。  
* 从一个与后端进行通信的应用开始。它是用C++写的。  
* 它在增长。多年来，Amazon为扩展所做的努力集中在扩展后端的数据库，使之能处理更多的商品，更多的顾客，更多的订单以及支持多个国际性站点。在2001年的时候，我们清楚的看到前端应用再也不能够进行扩展了。数据库被切分成很多个小的部分，并且为每个部分创建一个服务接口，这是访问数据的唯一途径。  
* 数据库变成了共享资源，这使得很难去扩展整个事情。前端和后端的处理在他们的迭代中被严格受限，因为这是被很多不同的团队和处理所共享的。  
* 架构是基于服务创建的，是松耦合的。一个基于服务的架构给他们提供了隔离性，这样能够让很多软件模块能够快速独立地构建。  
* 于是长成了数百个服务以及一些用来聚合服务数据的应用服务器。渲染Amazon.com网站页面的应用就是这样的一个应用服务器。网页服务接口、消费者服务应用和卖家接口也都如此。  
* 大量的第三方技术阻碍了Amazon大小的扩展。尤其是通信基础设施技术。在一定规模下它们工作的很好，但再大就出错了。所以他们必须自己创建。  
* 不坚持使用一个特别的方法。有的地方他们使用了jboss/java，但是他们只使用serlets，而不是用J2EE的其他东西。  
* 使用C++处理请求。Perl/Mason用来构建内容。  
* Amazon不喜欢中间件，因为它往往是框架而不是工具。如果你使用了一个中间件的包，你就被困在了他们所选择的软件模式里面了。你只能使用他们的软件。所以如果你想要使用不同的包那你就不能这样做。这太恶心了。比如消息传输重的事件循环，数据持久化，AJAX等等。太复杂了。如果中间件能够变成更小的组件，更像一个工具而不是像一个框架，那么这些都会变的更有趣。  
* SOAP的网络堆栈看起来想一次性解决所有的分布式系统问题问题。  
* 提供SOAP和REST两种服务。30%使用SOAP。这往往是Java或者.Net的用户，他们使用WSDL文件来生成远程对象接口。70%使用REST。这往往是PHP或者PERL用户。  
* 不管是SOAP还是REST的服务开发者都能从Amaon获得一个对象接口。开发者只想把任务做完，他们并不关心网线那边到底发生了什么。  
* Amazon想围绕他们的服务建立一个开发的社区。因为简单选择了网页服务。但是这仅仅是面向外面的客户。内部则是一个面向服务的架构。你只能通过接口来访问数据。接口在WSDL里面描述，但是他们使用自己的封装和传输机制。  
* 团队是精小和围绕服务组织的。  
  -- 服务是Amazon里独立提供功能的单位。这也是Amazon内部组织的方式。  
  -- 如果你有新的商业想法或者问题想要解决，那么你组建一个团队。为了沟通方便限制一个团队的人数为8-10人。这被称之为“两个匹萨”团队。因为这么多的人正好能够吃两个匹萨。  
  -- 团队是短小的。他们被授权使用任何他们觉得合适的方法作为一个服务来解决问题。  
  -- 举个例子来说，他们创建了一个团队来寻找书中唯一存在的短语。这个团队为这个特性创建了一个单独的服务接口。他们被授权去做任何他们觉得需要做的事情。  
  -- 广泛的A/B测试被用来整合一个新的服务。他们看看会造成什么影响，然后在进行全面的衡量。  
* 部署  
  -- 他们创建了特殊的基础设施用来管理依赖和进行部署。  
  -- 目的是确保一次性部署所有确切的服务。所有的应用代码，监控，监听等等都应该在一次操作里。  
  -- 每个人都有一个土生土长的系统来解决这些问题。  
  -- 部署过程的输出是一个虚拟机。你可以使用EC2来运行它们。  
* 通过客户的用户反馈来验证一个新服务是否值得。  
  -- 基于用户反馈工作。集中精力在你想要提供给用户的价值上。  
  -- 强迫开发人员关注给客户提供的价值上去，而不是先实现技术然后再指出如何使用这个东西。  
  -- 准备一个用户将要看到的特性清单，然后反过头来检测你正在创建一些有价值的东西。  
  --最终设计要尽可能地小。简单是你想要创建一个大规模分布式系统的关键。  

* 状态管理是大规模可扩展系统的核心问题。  
  -- 在内部可以提供无限的存储。  
  -- 不是所有的操作都是有状态的。结账步骤是有状态的。  
  -- 会基于session ID提供最近点击页面的推荐。  
  -- 他们跟踪了一切东西，所以保存状态是没什么问题的。有很少的独立状态需要保存在session里。服务已经准备好保存消息了，所以你只需要使用这些服务就好了。  
